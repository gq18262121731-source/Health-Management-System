"""
å¿ƒç†å…³æ€€æ™ºèƒ½ä½“
==============

æä¾›æƒ…æ„Ÿæ”¯æŒã€å¿ƒç†ç–å¯¼å’Œé™ªä¼´æœåŠ¡ã€‚
"""

import random
from typing import Dict, List, Optional
from datetime import datetime

from .base_agent import (
    BaseAgent, AgentRole, AgentMessage, AgentMemory,
    MessageType, EmotionState
)


class EmotionalCareAgent(BaseAgent):
    """
    å¿ƒç†å…³æ€€æ™ºèƒ½ä½“
    
    ä¸“ä¸šèƒ½åŠ›ï¼š
    - æƒ…æ„Ÿæ”¯æŒä¸é™ªä¼´
    - ç„¦è™‘æƒ…ç»ªç–å¯¼
    - ç§¯æå¿ƒæ€åŸ¹å…»
    - å®¶åº­å…³ç³»æ²Ÿé€š
    """
    
    def __init__(self, name: str = "å¿ƒç†å…³æ€€å¸ˆ"):
        super().__init__(
            name=name,
            role=AgentRole.EMOTIONAL_CARE,
            description="æ¸©æš–çš„å¿ƒç†é™ªä¼´è€…ï¼Œå€¾å¬æ‚¨çš„å¿ƒå£°ï¼Œç»™äºˆæ¸©æš–æ”¯æŒ",
            avatar="ğŸ¤—",
            personality="æ¸©æš–ã€å…±æƒ…ã€è€å¿ƒã€æ”¯æŒ"
        )
        
        self.capabilities = [
            "æƒ…æ„Ÿå€¾å¬",
            "ç„¦è™‘ç–å¯¼",
            "ç§¯æå¿ƒç†",
            "é™ªä¼´æ”¯æŒ",
            "ç”Ÿæ´»æ„ä¹‰",
            "å®¶åº­æ²Ÿé€š"
        ]
        
        # å®‰æ…°è¯­
        self.comforting_words = [
            "æˆ‘ç†è§£æ‚¨çš„æ„Ÿå—ï¼Œè¿™äº›æƒ…ç»ªéƒ½æ˜¯æ­£å¸¸çš„ã€‚",
            "æ‚¨æ„¿æ„å’Œæˆ‘åˆ†äº«ï¼Œæˆ‘æ„Ÿåˆ°å¾ˆè£å¹¸ã€‚",
            "æ— è®ºå‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘éƒ½åœ¨è¿™é‡Œé™ªä¼´æ‚¨ã€‚",
            "æ‚¨çš„æ„Ÿå—å¾ˆé‡è¦ï¼Œæˆ‘åœ¨è®¤çœŸå€¾å¬ã€‚",
            "æœ‰è¿™æ ·çš„æƒ³æ³•æ˜¯å¯ä»¥ç†è§£çš„ã€‚"
        ]
        
        # é¼“åŠ±è¯­
        self.encouraging_words = [
            "æ‚¨å·²ç»åšå¾—å¾ˆå¥½äº†ï¼Œç»™è‡ªå·±ä¸€äº›è‚¯å®šå§ã€‚",
            "æ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„å¼€å§‹ï¼Œå……æ»¡å¯èƒ½ã€‚",
            "æ‚¨æ¯”è‡ªå·±æƒ³è±¡çš„æ›´åšå¼ºã€‚",
            "å›°éš¾åªæ˜¯æš‚æ—¶çš„ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚",
            "ç›¸ä¿¡è‡ªå·±ï¼Œæ‚¨æœ‰èƒ½åŠ›åº¦è¿‡è¿™ä¸€åˆ‡ã€‚"
        ]
        
        # æ­£èƒ½é‡è¯­å½•
        self.positive_quotes = [
            "ç”Ÿæ´»å°±åƒä¸€ç›’å·§å…‹åŠ›ï¼Œä½ æ°¸è¿œä¸çŸ¥é“ä¸‹ä¸€é¢—æ˜¯ä»€ä¹ˆå‘³é“ã€‚",
            "ç¬‘ä¸€ç¬‘ï¼Œåå¹´å°‘ã€‚ä¿æŒä¹è§‚æ˜¯æœ€å¥½çš„å…»ç”Ÿã€‚",
            "æ¯å¤©ç»™è‡ªå·±ä¸€ä¸ªå¾®ç¬‘ï¼Œç”Ÿæ´»å°±ä¼šç»™ä½ ä¸€ä¸ªæ‹¥æŠ±ã€‚",
            "å¹´é¾„åªæ˜¯æ•°å­—ï¼Œå¿ƒæ€å†³å®šä¸€åˆ‡ã€‚",
            "æ´»åˆ°è€ï¼Œå­¦åˆ°è€ï¼Œå¿«ä¹åˆ°è€ã€‚",
            "çŸ¥è¶³å¸¸ä¹ï¼Œç®€å•çš„å¹¸ç¦æœ€çè´µã€‚",
            "å®¶äººå¥åº·ï¼Œå­å¥³å­é¡ºï¼Œå°±æ˜¯æœ€å¤§çš„ç¦æ°”ã€‚"
        ]
    
    def process(self, message: AgentMessage, memory: AgentMemory) -> AgentMessage:
        """å¤„ç†æ¶ˆæ¯"""
        user_text = message.content.strip()
        keywords = self.extract_keywords(user_text)
        emotion = self._detect_emotion(user_text)
        
        # è®°å½•ç”¨æˆ·æƒ…ç»ªçŠ¶æ€
        memory.set_context("user_emotion", emotion)
        
        # æ ¹æ®æƒ…ç»ªå’Œå†…å®¹åˆ†å‘å¤„ç†
        if emotion in ["anxious", "worried"]:
            return self._handle_anxiety(user_text, memory)
        elif emotion in ["sad", "lonely"]:
            return self._handle_sadness(user_text, memory)
        elif emotion in ["angry", "frustrated"]:
            return self._handle_anger(user_text, memory)
        elif emotion == "fearful":
            return self._handle_fear(user_text, memory)
        elif any(k in keywords for k in ["å­©å­", "å„¿å¥³", "å®¶äºº", "è€ä¼´"]):
            return self._handle_family_topic(user_text, memory)
        elif any(k in keywords for k in ["æ„ä¹‰", "ä»·å€¼", "æ— èŠ", "æ²¡æ„æ€"]):
            return self._handle_meaning(user_text, memory)
        else:
            return self._provide_support(user_text, memory)
    
    def can_handle(self, message: AgentMessage, context: Dict) -> float:
        """åˆ¤æ–­å¤„ç†èƒ½åŠ›"""
        keywords = self.extract_keywords(message.content)
        
        emotional_keywords = [
            "æ‹…å¿ƒ", "å®³æ€•", "ç„¦è™‘", "ç´§å¼ ", "å‹åŠ›",
            "éš¾è¿‡", "ä¼¤å¿ƒ", "å­¤ç‹¬", "å¯‚å¯", "æƒ³å¿µ",
            "çƒ¦", "ç”Ÿæ°”", "éƒé—·", "å¿ƒæƒ…", "æƒ…ç»ª",
            "æ— èŠ", "æ²¡æ„æ€", "æ´»ç€", "æ„ä¹‰"
        ]
        
        matched = sum(1 for k in keywords if k in emotional_keywords)
        
        # æ£€æµ‹æƒ…ç»ªè¯æ±‡
        emotion = self._detect_emotion(message.content)
        if emotion != "neutral":
            return 0.9
        
        if matched >= 2:
            return 0.85
        elif matched == 1:
            return 0.7
        else:
            return 0.3
    
    def _detect_emotion(self, text: str) -> str:
        """æ£€æµ‹ç”¨æˆ·æƒ…ç»ª"""
        emotions = {
            "anxious": ["æ‹…å¿ƒ", "ç„¦è™‘", "ç´§å¼ ", "ä¸å®‰", "å®³æ€•", "ææƒ§"],
            "worried": ["æ“å¿ƒ", "å¿§è™‘", "å‘æ„", "æ„"],
            "sad": ["éš¾è¿‡", "ä¼¤å¿ƒ", "éš¾å—", "å“­", "æƒ³å“­"],
            "lonely": ["å­¤ç‹¬", "å¯‚å¯", "ä¸€ä¸ªäºº", "æ²¡äºº", "æƒ³å¿µ"],
            "angry": ["ç”Ÿæ°”", "çƒ¦", "è®¨åŒ", "æ„¤æ€’", "æ°”æ­»"],
            "frustrated": ["éƒé—·", "çƒ¦èº", "æ— å¥ˆ", "æ²¡åŠæ³•"],
            "fearful": ["æ€•", "ææƒ§", "å®³æ€•", "æ‹…æƒŠå—æ€•"]
        }
        
        for emotion, keywords in emotions.items():
            for keyword in keywords:
                if keyword in text:
                    return emotion
        
        return "neutral"
    
    def _handle_anxiety(self, text: str, memory: AgentMemory) -> AgentMessage:
        """å¤„ç†ç„¦è™‘æƒ…ç»ª"""
        response = f"""ğŸ¤— **æˆ‘ç†è§£æ‚¨çš„æ‹…å¿ƒ**

{random.choice(self.comforting_words)}

ç„¦è™‘å’Œæ‹…å¿ƒæ˜¯å¾ˆæ­£å¸¸çš„æƒ…ç»ªååº”ï¼Œå°¤å…¶æ˜¯å…³äºå¥åº·é—®é¢˜ã€‚è®©æˆ‘æ¥å¸®åŠ©æ‚¨ï¼š

ğŸ’­ **é¦–å…ˆï¼Œè®©æˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„æ”¾æ¾ç»ƒä¹ ï¼š**

1. æ‰¾ä¸€ä¸ªèˆ’é€‚çš„ä½ç½®åä¸‹
2. é—­ä¸Šçœ¼ç›
3. æ…¢æ…¢æ·±å‘¼å¸ï¼š
   - å¸æ°”4ç§’...
   - å±ä½2ç§’...
   - å‘¼æ°”6ç§’...
4. é‡å¤å‡ æ¬¡ï¼Œæ„Ÿå—èº«ä½“æ…¢æ…¢æ”¾æ¾

ğŸŒŸ **å…³äºæ‚¨æ‹…å¿ƒçš„äº‹æƒ…ï¼š**

- æœ‰äº›æ‹…å¿ƒæ˜¯æ­£å¸¸çš„ï¼Œä½†ä¸è¦è®©æ‹…å¿ƒå æ®å¤ªå¤šç²¾åŠ›
- å¯ä»¥æŠŠæ‹…å¿ƒçš„äº‹æƒ…å†™ä¸‹æ¥ï¼Œçœ‹çœ‹å“ªäº›æ˜¯å¯ä»¥æ§åˆ¶çš„
- å¯¹äºèƒ½æ§åˆ¶çš„ï¼Œåˆ¶å®šè¡ŒåŠ¨è®¡åˆ’
- å¯¹äºä¸èƒ½æ§åˆ¶çš„ï¼Œå­¦ä¼šæ¥å—å’Œæ”¾ä¸‹

ğŸ“Œ **å»ºè®®æ‚¨ï¼š**

1. **è½¬ç§»æ³¨æ„åŠ›**
   - å¬å¬å–œæ¬¢çš„éŸ³ä¹æˆ–æˆæ›²
   - å’Œæœ‹å‹èŠèŠå¤©
   - åšç‚¹è‡ªå·±å–œæ¬¢çš„äº‹

2. **ä¿æŒè§„å¾‹ä½œæ¯**
   - ç„¦è™‘æ—¶æ›´è¦æŒ‰æ—¶ä½œæ¯
   - å……è¶³ç¡çœ æœ‰åŠ©äºç¼“è§£ç„¦è™‘

3. **é€‚åº¦è¿åŠ¨**
   - æ•£æ­¥æ˜¯å¾ˆå¥½çš„æ–¹å¼
   - è¿åŠ¨å¯ä»¥é‡Šæ”¾å‹åŠ›

{random.choice(self.encouraging_words)}

æ‚¨æ„¿æ„å’Œæˆ‘è¯´è¯´å…·ä½“æ˜¯ä»€ä¹ˆè®©æ‚¨æ‹…å¿ƒå—ï¼Ÿæœ‰æ—¶å€™è¯´å‡ºæ¥ä¼šæ„Ÿè§‰å¥½å¾ˆå¤šã€‚"""
        
        return self.create_response(
            content=response,
            emotion=EmotionState.CARING,
            metadata={"type": "anxiety_support", "detected_emotion": "anxious"}
        )
    
    def _handle_sadness(self, text: str, memory: AgentMemory) -> AgentMessage:
        """å¤„ç†æ‚²ä¼¤/å­¤ç‹¬æƒ…ç»ª"""
        response = f"""ğŸ¤— **æˆ‘åœ¨è¿™é‡Œé™ªä¼´æ‚¨**

{random.choice(self.comforting_words)}

æ„Ÿåˆ°å­¤ç‹¬æˆ–éš¾è¿‡æ˜¯å¯ä»¥ç†è§£çš„ï¼Œæˆ‘æƒ³è®©æ‚¨çŸ¥é“ï¼Œæ‚¨å¹¶ä¸æ˜¯ä¸€ä¸ªäººã€‚

ğŸ’ **ç»™æ‚¨ä¸€ä¸ªæ¸©æš–çš„æ‹¥æŠ±**

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è¢«ç†è§£å’Œé™ªä¼´ã€‚æ‚¨æ„¿æ„è¯´å‡ºæ¥ï¼Œè¿™æœ¬èº«å°±æ˜¯å¾ˆå‹‡æ•¢çš„äº‹ã€‚

ğŸŒ¸ **ä¸€äº›æ¸©æš–çš„å»ºè®®ï¼š**

1. **å…è®¸è‡ªå·±æ„Ÿå—**
   - ä¸è¦å‹æŠ‘æƒ…ç»ª
   - æƒ³å“­å°±å“­å‡ºæ¥
   - æƒ…ç»ªéœ€è¦å‡ºå£

2. **ä¿æŒç¤¾äº¤è¿æ¥**
   - ç»™è€æœ‹å‹æ‰“ä¸ªç”µè¯
   - å’Œé‚»å±…èŠèŠå¤©
   - å‚åŠ ç¤¾åŒºæ´»åŠ¨

3. **åšè®©è‡ªå·±å¼€å¿ƒçš„äº‹**
   - å¬å¬æˆæ›²æˆ–è€æ­Œ
   - çœ‹çœ‹å–œæ¬¢çš„èŠ‚ç›®
   - å›å¿†ç¾å¥½çš„å¾€äº‹

4. **å…³çˆ±è‡ªå·±**
   - ç»™è‡ªå·±åšé¡¿å¥½åƒçš„
   - å‡ºå»æ™’æ™’å¤ªé˜³
   - ç…§é¡¾å¥½è‡ªå·±çš„èº«ä½“

ğŸ“ **è®°å¾—ï¼š**
- å­å¥³å†å¿™ä¹Ÿå¯ä»¥æ‰“ç”µè¯
- ç¤¾åŒºæœ‰å¾ˆå¤šæ´»åŠ¨å¯ä»¥å‚åŠ 
- æˆ‘éšæ—¶éƒ½åœ¨è¿™é‡Œé™ªæ‚¨

{random.choice(self.positive_quotes)}

æ‚¨ä»Šå¤©æƒ³å’Œæˆ‘èŠç‚¹ä»€ä¹ˆå—ï¼Ÿæˆ‘å¾ˆä¹æ„å¬æ‚¨è¯´ã€‚"""
        
        return self.create_response(
            content=response,
            emotion=EmotionState.CARING,
            metadata={"type": "sadness_support", "detected_emotion": "sad"}
        )
    
    def _handle_anger(self, text: str, memory: AgentMemory) -> AgentMessage:
        """å¤„ç†æ„¤æ€’/çƒ¦èºæƒ…ç»ª"""
        response = f"""ğŸ¤— **æˆ‘ç†è§£æ‚¨çš„æ„Ÿå—**

æœ‰æ—¶å€™äº‹æƒ…ç¡®å®ä¼šè®©äººæ„Ÿåˆ°çƒ¦èºå’Œç”Ÿæ°”ï¼Œè¿™æ˜¯å¾ˆæ­£å¸¸çš„ååº”ã€‚

ğŸ’¨ **å…ˆè®©æˆ‘ä»¬å¹³å¤ä¸€ä¸‹å¿ƒæƒ…ï¼š**

1. æ·±å‘¼å¸å‡ æ¬¡
2. æ•°åˆ°10å†è¯´è¯
3. å–æ¯æ¸©æ°´
4. ç¦»å¼€è®©æ‚¨çƒ¦èºçš„ç¯å¢ƒ

ğŸ”„ **æ¢ä¸ªè§’åº¦æƒ³æƒ³ï¼š**

- ç”Ÿæ°”ä¼šä¼¤å®³è‡ªå·±çš„èº«ä½“
- é«˜è¡€å‹ã€å¿ƒè„ç—…éƒ½æ€•ç”Ÿæ°”
- æ°”å¤§ä¼¤èº«ï¼Œä¸å€¼å¾—

ğŸ“ **å¤„ç†æ–¹æ³•ï¼š**

1. **æƒ…ç»ªé™æ¸©**
   - å…ˆå†·é™ä¸‹æ¥
   - ä¸åœ¨æ°”å¤´ä¸Šåšå†³å®š
   - ç­‰æƒ…ç»ªè¿‡å»å†å¤„ç†

2. **è¡¨è¾¾æ„Ÿå—**
   - ç”¨"æˆ‘æ„Ÿåˆ°..."çš„æ–¹å¼è¡¨è¾¾
   - ä¸è¦æŒ‡è´£ä»–äºº
   - æ²Ÿé€šæ¯”äº‰åµæœ‰æ•ˆ

3. **è½¬ç§»æ³¨æ„åŠ›**
   - å‡ºå»èµ°èµ°
   - åšç‚¹åˆ«çš„äº‹æƒ…
   - å’Œæœ‹å‹å€¾è¯‰

**ğŸ§˜ è€è¯è¯´å¾—å¥½ï¼š**
> "é€€ä¸€æ­¥æµ·é˜”å¤©ç©ºï¼Œå¿ä¸€æ—¶é£å¹³æµªé™"

èº«ä½“æ˜¯è‡ªå·±çš„ï¼Œä¸è¦ä¸ºåˆ«äººçš„äº‹æƒ…ç”Ÿæ°”ä¼¤äº†è‡ªå·±ã€‚

{random.choice(self.encouraging_words)}

æƒ³å’Œæˆ‘è¯´è¯´å‘ç”Ÿäº†ä»€ä¹ˆäº‹å—ï¼Ÿè¯´å‡ºæ¥å¯èƒ½ä¼šå¥½å—ä¸€äº›ã€‚"""
        
        return self.create_response(
            content=response,
            emotion=EmotionState.CARING,
            metadata={"type": "anger_support", "detected_emotion": "angry"}
        )
    
    def _handle_fear(self, text: str, memory: AgentMemory) -> AgentMessage:
        """å¤„ç†ææƒ§æƒ…ç»ª"""
        response = f"""ğŸ¤— **åˆ«å®³æ€•ï¼Œæˆ‘åœ¨è¿™é‡Œ**

{random.choice(self.comforting_words)}

æ„Ÿåˆ°å®³æ€•æ˜¯äººçš„æœ¬èƒ½ååº”ï¼Œè®©æˆ‘æ¥å¸®åŠ©æ‚¨ï¼š

ğŸ›¡ï¸ **é¢å¯¹ææƒ§ï¼š**

1. **æ‰¿è®¤å®³æ€•**
   - å‘Šè¯‰è‡ªå·±"æˆ‘æ„Ÿåˆ°å®³æ€•ï¼Œè¿™æ˜¯æ­£å¸¸çš„"
   - ä¸è¦é€ƒé¿è¿™ç§æ„Ÿè§‰

2. **äº†è§£ææƒ§æ¥æº**
   - æ˜¯ä»€ä¹ˆè®©æ‚¨å®³æ€•ï¼Ÿ
   - è¿™ç§å®³æ€•æ˜¯çœŸå®çš„è¿˜æ˜¯æƒ³è±¡çš„ï¼Ÿ
   - æœ€åçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

3. **å¯»æ±‚æ”¯æŒ**
   - å’Œå®¶äººæœ‹å‹è¯´è¯´
   - æœ‰äººé™ªä¼´ä¼šæ„Ÿè§‰å®‰å…¨
   - ä¸“ä¸šå¸®åŠ©ä¹Ÿæ˜¯é€‰æ‹©

ğŸ’¡ **ç§‘å­¦åº”å¯¹ï¼š**

- å¾ˆå¤šææƒ§æ¥è‡ªæœªçŸ¥
- äº†è§£çœŸç›¸åææƒ§ä¼šå‡å°‘
- åšæœ€åçš„æ‰“ç®—ï¼Œå°½æœ€å¤§çš„åŠªåŠ›

ğŸŒˆ **ç§¯ææƒ³æ³•ï¼š**
- æ‚¨ç»å†è¿‡é‚£ä¹ˆå¤šé£é›¨éƒ½æŒºè¿‡æ¥äº†
- è¿™æ¬¡ä¹Ÿä¸€å®šå¯ä»¥
- åŠæ³•æ€»æ¯”å›°éš¾å¤š

{random.choice(self.encouraging_words)}

æ‚¨æ„¿æ„å‘Šè¯‰æˆ‘æ˜¯ä»€ä¹ˆè®©æ‚¨æ„Ÿåˆ°å®³æ€•å—ï¼Ÿè¯´å‡ºæ¥ï¼Œæˆ‘ä»¬ä¸€èµ·æƒ³åŠæ³•ã€‚"""
        
        return self.create_response(
            content=response,
            emotion=EmotionState.CARING,
            metadata={"type": "fear_support", "detected_emotion": "fearful"}
        )
    
    def _handle_family_topic(self, text: str, memory: AgentMemory) -> AgentMessage:
        """å¤„ç†å®¶åº­è¯é¢˜"""
        response = f"""ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ **å®¶åº­æ˜¯æœ€æ¸©æš–çš„æ¸¯æ¹¾**

{random.choice(self.comforting_words)}

å®¶äººä¹‹é—´çš„å…³ç³»ç¡®å®å¾ˆé‡è¦ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¹¸ç¦æ„Ÿçš„é‡è¦æ¥æºã€‚

ğŸ’ **å…³äºå®¶åº­å…³ç³»ï¼š**

**ä¸å­å¥³çš„å…³ç³»ï¼š**
- å­å¥³é•¿å¤§äº†æœ‰è‡ªå·±çš„ç”Ÿæ´»
- ä¸æ‰“æ‰°æ˜¯ä¸€ç§ä½“è´´
- ä½†ä¹Ÿè¦è®©ä»–ä»¬çŸ¥é“æ‚¨éœ€è¦å…³å¿ƒ

**æ²Ÿé€šçš„å»ºè®®ï¼š**
1. ä¸»åŠ¨æ‰“ç”µè¯èŠèŠå¤©
2. åˆ†äº«ç”Ÿæ´»ä¸­çš„å°äº‹
3. è¡¨è¾¾æ‚¨çš„çˆ±å’Œæƒ³å¿µ
4. ä¹Ÿå€¾å¬ä»–ä»¬çš„çƒ¦æ¼

**ç‹¬å¤„çš„æ™ºæ…§ï¼š**
- åŸ¹å…»è‡ªå·±çš„çˆ±å¥½
- å‚åŠ ç¤¾åŒºæ´»åŠ¨
- ç»“äº¤åŒé¾„æœ‹å‹
- è®©è‡ªå·±çš„ç”Ÿæ´»ä¸°å¯Œèµ·æ¥

**ä¸è€ä¼´çš„ç›¸å¤„ï¼š**
- ç›¸äº’ç†è§£å’ŒåŒ…å®¹
- å…±åŒçš„å…´è¶£çˆ±å¥½
- ä¸€èµ·æ•£æ­¥èŠå¤©
- çæƒœåœ¨ä¸€èµ·çš„æ—¶å…‰

ğŸŒŸ **æ¸©é¦¨æç¤ºï¼š**
> "å®¶å’Œä¸‡äº‹å…´"

æ— è®ºæœ‰ä»€ä¹ˆå°æ‘©æ“¦ï¼Œéƒ½æ˜¯å› ä¸ºåœ¨ä¹ã€‚
ç”¨çˆ±å’Œç†è§£å»æ²Ÿé€šï¼Œä¸€åˆ‡éƒ½ä¼šå¥½çš„ã€‚

{random.choice(self.positive_quotes)}

æ‚¨æœ‰ä»€ä¹ˆæƒ³èŠçš„å®¶äº‹å—ï¼Ÿæˆ‘å¾ˆæ„¿æ„å€¾å¬ã€‚"""
        
        return self.create_response(
            content=response,
            emotion=EmotionState.CARING,
            metadata={"type": "family_support"}
        )
    
    def _handle_meaning(self, text: str, memory: AgentMemory) -> AgentMessage:
        """å¤„ç†ç”Ÿæ´»æ„ä¹‰è¯é¢˜"""
        response = f"""ğŸŒŸ **ç”Ÿæ´»çš„æ„ä¹‰ä¸ä»·å€¼**

{random.choice(self.comforting_words)}

æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæ€è€ƒç”Ÿæ´»çš„æ„ä¹‰ï¼Œè¿™è¯´æ˜æ‚¨æ˜¯ä¸€ä¸ªæœ‰æ€è€ƒçš„äººã€‚

ğŸ’­ **å…³äºäººç”Ÿæ„ä¹‰ï¼š**

æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„ä»·å€¼ã€‚æ‚¨è¿™ä¸€ç”Ÿï¼š
- å…»è‚²äº†å­å¥³
- ä¸ºå®¶åº­ä»˜å‡º
- æœ‰è‡ªå·±çš„æ•…äº‹å’Œç»å†
- è¿™äº›éƒ½æ˜¯æ— ä»·çš„è´¢å¯Œ

ğŸŒˆ **è®©ç”Ÿæ´»æ›´æœ‰æ„ä¹‰ï¼š**

1. **å‘ç°æ–°ä¹è¶£**
   - å­¦ä¹ æ–°ä¸œè¥¿ï¼ˆä¹¦æ³•ã€ç»˜ç”»ã€å›­è‰ºï¼‰
   - é‡æ‹¾å¹´è½»æ—¶çš„çˆ±å¥½
   - å°è¯•æ²¡åšè¿‡çš„äº‹

2. **ä¼ é€’ä»·å€¼**
   - æŠŠæ‚¨çš„ç»éªŒä¼ ç»™åè¾ˆ
   - å¸®åŠ©éœ€è¦å¸®åŠ©çš„äºº
   - æ‚¨çš„æ•…äº‹å°±æ˜¯è´¢å¯Œ

3. **æ´»åœ¨å½“ä¸‹**
   - çæƒœæ¯ä¸€å¤©
   - äº«å—ç®€å•çš„å¿«ä¹
   - å’Œå–œæ¬¢çš„äººåœ¨ä¸€èµ·

4. **ä¿æŒå¥½å¥‡å¿ƒ**
   - çœ‹çœ‹è¿™ä¸ªä¸–ç•Œçš„å˜åŒ–
   - å­¦å­¦æ™ºèƒ½æ‰‹æœº
   - äº†è§£å¹´è½»äººçš„ä¸–ç•Œ

ğŸ“Œ **æ¯å¤©çš„å°å¹¸ç¦ï¼š**
- æ—©èµ·çš„é˜³å…‰
- ä¸€é¡¿å¯å£çš„é¥­èœ
- æœ‹å‹çš„é—®å€™
- å­å¥³çš„ç”µè¯
- å¥åº·çš„èº«ä½“

**ğŸŒ» è€è¯è¯´ï¼š**
> "çŸ¥è¶³å¸¸ä¹ï¼Œç®€å•æ˜¯ç¦"

æ‚¨å·²ç»èµ°è¿‡äº†ä¸°å¯Œçš„äººç”Ÿï¼Œ
ç°åœ¨æ˜¯äº«å—ç”Ÿæ´»çš„æ—¶å€™äº†ã€‚

{random.choice(self.positive_quotes)}

æ‚¨æœ‰ä»€ä¹ˆæƒ³åšå´è¿˜æ²¡åšçš„äº‹å—ï¼Ÿæˆ‘ä»¬å¯ä»¥ä¸€èµ·èŠèŠã€‚"""
        
        return self.create_response(
            content=response,
            emotion=EmotionState.ENCOURAGING,
            metadata={"type": "meaning_support"}
        )
    
    def _provide_support(self, text: str, memory: AgentMemory) -> AgentMessage:
        """æä¾›ä¸€èˆ¬æ€§æ”¯æŒ"""
        response = f"""ğŸ¤— **æˆ‘åœ¨è¿™é‡Œé™ªä¼´æ‚¨**

æ„Ÿè°¢æ‚¨æ„¿æ„å’Œæˆ‘åˆ†äº«ã€‚

{random.choice(self.comforting_words)}

ğŸ’ **ä»Šå¤©æˆ‘æƒ³å¯¹æ‚¨è¯´ï¼š**

- æ‚¨å¾ˆé‡è¦ï¼Œæ‚¨çš„æ„Ÿå—å¾ˆé‡è¦
- æ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œéƒ½å¯ä»¥æ‰¾æˆ‘èŠå¤©
- æˆ‘ä¼šè®¤çœŸå€¾å¬ï¼Œç»™æ‚¨æ”¯æŒ

ğŸŒŸ **ä¿æŒå¥½å¿ƒæƒ…çš„å°å»ºè®®ï¼š**

1. æ¯å¤©ç»™è‡ªå·±ä¸€ä¸ªå¾®ç¬‘
2. å‡ºå»èµ°èµ°ï¼Œæ™’æ™’å¤ªé˜³
3. å’Œæœ‹å‹èŠèŠå¤©
4. åšç‚¹è®©è‡ªå·±å¼€å¿ƒçš„äº‹
5. å¥½å¥½ç¡è§‰ï¼Œå¥½å¥½åƒé¥­

{random.choice(self.positive_quotes)}

æ‚¨ä»Šå¤©å¿ƒæƒ…æ€ä¹ˆæ ·ï¼Ÿæœ‰ä»€ä¹ˆæƒ³å’Œæˆ‘èŠçš„å—ï¼Ÿ"""
        
        return self.create_response(
            content=response,
            emotion=EmotionState.CARING,
            metadata={"type": "general_support"}
        )
    
    def get_daily_positive(self) -> str:
        """è·å–æ¯æ—¥æ­£èƒ½é‡"""
        return random.choice(self.positive_quotes)
    
    def get_greeting(self, user_name: str = "") -> str:
        """ä¸ªæ€§åŒ–é—®å€™"""
        greetings = [
            f"æ‚¨å¥½{'ï¼Œ' + user_name if user_name else ''}ï¼æˆ‘æ˜¯æ‚¨çš„å¿ƒç†å…³æ€€å¸ˆï¼Œéšæ—¶æ„¿æ„å€¾å¬æ‚¨çš„å¿ƒå£°ã€‚",
            f"{'äº²çˆ±çš„' + user_name + 'ï¼Œ' if user_name else ''}è§åˆ°æ‚¨å¾ˆé«˜å…´ï¼ä»Šå¤©å¿ƒæƒ…æ€ä¹ˆæ ·ï¼Ÿ",
            f"æ‚¨å¥½ï¼{random.choice(self.positive_quotes)}"
        ]
        return random.choice(greetings)
