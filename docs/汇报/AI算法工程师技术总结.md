# AIç®—æ³•å·¥ç¨‹å¸ˆæŠ€æœ¯æ€»ç»“

> å…»ç”Ÿä¹‹é“æ™ºèƒ½å¥åº·ç®¡ç†ç³»ç»Ÿ - å¤šæ™ºèƒ½ä½“æ¶æ„ã€RAGçŸ¥è¯†åº“ã€æ„å›¾è¯†åˆ«

---

## ä¸€ã€è´Ÿè´£æ¨¡å—æ¦‚è§ˆ

| æ¨¡å— | æŠ€æœ¯æ ˆ | æ ¸å¿ƒèŒè´£ |
|------|--------|----------|
| **å¤šæ™ºèƒ½ä½“æ¶æ„** | Python + è‡ªç ”æ¡†æ¶ | 4ä¸ªä¸“ä¸šæ™ºèƒ½ä½“åä½œç³»ç»Ÿ |
| **RAGçŸ¥è¯†åº“** | FAISS + m3e-base | å‘é‡æ£€ç´¢å¢å¼ºç”Ÿæˆ |
| **æ„å›¾è¯†åˆ«** | å…³é”®è¯åŒ¹é… + ç½®ä¿¡åº¦è·¯ç”± | ç”¨æˆ·æ„å›¾åˆ†ç±»ä¸è·¯ç”± |

---

## äºŒã€æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ¶æ„å›¾                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚                         ç”¨æˆ·è¾“å…¥                                         â”‚
â”‚                            â†“                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              MultiAgentSystem (å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ)                      â”‚   â”‚
â”‚   â”‚                                                                   â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚   â”‚           AgentCoordinator (åè°ƒå™¨)                        â”‚  â”‚   â”‚
â”‚   â”‚   â”‚                                                            â”‚  â”‚   â”‚
â”‚   â”‚   â”‚   æ„å›¾è¯†åˆ« â†’ ç½®ä¿¡åº¦è·¯ç”± â†’ å“åº”æ•´åˆ                          â”‚  â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â”‚                            â†“                                     â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚   â”‚                    æ™ºèƒ½ä½“é›†ç¾¤                             â”‚   â”‚   â”‚
â”‚   â”‚   â”‚                                                           â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  â”‚ å¥åº·ç®¡å®¶ â”‚ â”‚ æ…¢ç—…ä¸“å®¶ â”‚ â”‚ ç”Ÿæ´»æ•™ç»ƒ â”‚ â”‚å¿ƒç†å…³æ€€å¸ˆâ”‚         â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  â”‚  å°åº·    â”‚ â”‚   ğŸ©º    â”‚ â”‚   ğŸƒ    â”‚ â”‚   ğŸ¤—    â”‚         â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  â”‚ ğŸ‘¨â€âš•ï¸     â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚         â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  â”‚(é»˜è®¤)   â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚         â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â†“                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     æ”¯æ’‘ç³»ç»Ÿ                                      â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚ RAG çŸ¥è¯†åº“    â”‚  â”‚ æ„å›¾è¯†åˆ«å™¨    â”‚  â”‚ è®°å¿†ç³»ç»Ÿ          â”‚    â”‚   â”‚
â”‚   â”‚  â”‚ FAISS + m3e   â”‚  â”‚ å…³é”®è¯+ç½®ä¿¡åº¦  â”‚  â”‚ çŸ­æœŸ+é•¿æœŸè®°å¿†     â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ ¸å¿ƒä»£ç æ¨¡å—

### 3.1 ä»£ç æ–‡ä»¶æ¸…å•

#### æ™ºèƒ½ä½“æ¨¡å— (`frontend/health_assessment_system/agents/`)

| æ–‡ä»¶ | åŠŸèƒ½ | ä»£ç è¡Œæ•° |
|------|------|----------|
| `base_agent.py` | æ™ºèƒ½ä½“åŸºç±»å®šä¹‰ | 265 è¡Œ |
| `agent_coordinator.py` | æ™ºèƒ½ä½“åè°ƒå™¨ | 290 è¡Œ |
| `multi_agent_system.py` | å¤šæ™ºèƒ½ä½“ç³»ç»Ÿå…¥å£ | 390 è¡Œ |
| `health_butler.py` | å¥åº·ç®¡å®¶æ™ºèƒ½ä½“ | 565 è¡Œ |
| `chronic_disease_expert.py` | æ…¢ç—…ä¸“å®¶æ™ºèƒ½ä½“ | 518 è¡Œ |
| `lifestyle_coach.py` | ç”Ÿæ´»æ–¹å¼æ•™ç»ƒ | 553 è¡Œ |
| `emotional_care.py` | å¿ƒç†å…³æ€€å¸ˆæ™ºèƒ½ä½“ | 493 è¡Œ |

#### åç«¯æœåŠ¡ (`backend/services/`)

| æ–‡ä»¶ | åŠŸèƒ½ | ä»£ç è¡Œæ•° |
|------|------|----------|
| `knowledge_base.py` | RAG çŸ¥è¯†åº“æœåŠ¡ | 393 è¡Œ |
| `agents/intent_recognizer.py` | æ„å›¾è¯†åˆ«å™¨ | ~200 è¡Œ |

**æ€»ä»£ç é‡**ï¼šçº¦ **4,000+ è¡Œ** Python ä»£ç 

---

## å››ã€å¤šæ™ºèƒ½ä½“æ¶æ„

### 4.1 æ™ºèƒ½ä½“åŸºç±»è®¾è®¡

```python
class AgentRole(Enum):
    """æ™ºèƒ½ä½“è§’è‰²æšä¸¾"""
    HEALTH_BUTLER = "health_butler"      # å¥åº·ç®¡å®¶ï¼ˆä¸»äº¤äº’ï¼‰
    CHRONIC_EXPERT = "chronic_expert"    # æ…¢ç—…ä¸“å®¶
    LIFESTYLE_COACH = "lifestyle_coach"  # ç”Ÿæ´»æ–¹å¼æ•™ç»ƒ
    EMOTIONAL_CARE = "emotional_care"    # å¿ƒç†å…³æ€€å¸ˆ


class BaseAgent(ABC):
    """æ™ºèƒ½ä½“åŸºç±»"""
    
    def __init__(self, name, role, description, avatar, personality):
        self.name = name
        self.role = role
        self.description = description
        self.avatar = avatar
        self.personality = personality
        self.capabilities = []
        self.is_active = True
    
    @abstractmethod
    def process(self, message: AgentMessage, memory: AgentMemory) -> AgentMessage:
        """å¤„ç†æ¶ˆæ¯å¹¶ç”Ÿæˆå“åº”"""
        pass
    
    @abstractmethod
    def can_handle(self, message: AgentMessage, context: Dict) -> float:
        """åˆ¤æ–­èƒ½å¦å¤„ç†è¯¥æ¶ˆæ¯ï¼Œè¿”å›ç½®ä¿¡åº¦ 0-1"""
        pass
```

### 4.2 å››å¤§æ™ºèƒ½ä½“çŸ©é˜µ

| æ™ºèƒ½ä½“ | å¤´åƒ | è§¦å‘å…³é”®è¯ | æ ¸å¿ƒèƒ½åŠ› |
|--------|------|------------|----------|
| **å¥åº·ç®¡å®¶ï¼ˆå°åº·ï¼‰** | ğŸ‘¨â€âš•ï¸ | é»˜è®¤/é—®å€™/æŸ¥è¯¢ | æ—¥å¸¸äº¤äº’å…¥å£ã€æ•°æ®è§£è¯» |
| **æ…¢ç—…ä¸“å®¶** | ğŸ©º | è¡€å‹/è¡€ç³–/è¡€è„‚/å¿ƒè„ | ä¸“ä¸šç–¾ç—…åˆ†æã€ç”¨è¯æé†’ |
| **ç”Ÿæ´»æ•™ç»ƒ** | ğŸƒ | è¿åŠ¨/é¥®é£Ÿ/ç¡çœ /å‡è‚¥ | ç”Ÿæ´»æ–¹å¼æŒ‡å¯¼ã€è¿åŠ¨å¤„æ–¹ |
| **å¿ƒç†å…³æ€€å¸ˆ** | ğŸ¤— | ç„¦è™‘/æ‹…å¿ƒ/å­¤ç‹¬/éš¾è¿‡ | æƒ…æ„Ÿæ”¯æŒã€å¿ƒç†ç–å¯¼ |

---

## äº”ã€ğŸ¯ æ ¸å¿ƒä»£ç å±•ç¤ºï¼ˆæ¼”è®²ç”¨ï¼‰

### ã€æ¼”è®²ä»£ç ç‰‡æ®µã€‘æ™ºèƒ½ä½“åè°ƒå™¨ - ç½®ä¿¡åº¦è·¯ç”±æœºåˆ¶

```python
class AgentCoordinator:
    """
    æ™ºèƒ½ä½“åè°ƒå™¨ - å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„æ ¸å¿ƒè°ƒåº¦ä¸­å¿ƒ
    
    èŒè´£ï¼š
    - ç®¡ç†æ‰€æœ‰æ³¨å†Œçš„æ™ºèƒ½ä½“
    - æ ¹æ®æ¶ˆæ¯å†…å®¹è·¯ç”±åˆ°åˆé€‚çš„æ™ºèƒ½ä½“ï¼ˆç½®ä¿¡åº¦æœºåˆ¶ï¼‰
    - åè°ƒå¤šæ™ºèƒ½ä½“åä½œå¤„ç†å¤æ‚é—®é¢˜
    - æ•´åˆå¤šä¸ªæ™ºèƒ½ä½“çš„å“åº”
    """
    
    def __init__(self):
        self.agents: Dict[AgentRole, BaseAgent] = {}
        self.default_agent: Optional[AgentRole] = None
    
    def register_agent(self, agent: BaseAgent, is_default: bool = False):
        """æ³¨å†Œæ™ºèƒ½ä½“åˆ°åè°ƒå™¨"""
        self.agents[agent.role] = agent
        if is_default:
            self.default_agent = agent.role
    
    def route_message(self, message: AgentMessage, context: Dict) -> Tuple[BaseAgent, float]:
        """
        ğŸ¯ æ ¸å¿ƒè·¯ç”±ç®—æ³• - åŸºäºç½®ä¿¡åº¦çš„æ™ºèƒ½ä½“é€‰æ‹©
        
        å·¥ä½œåŸç†ï¼š
        1. éå†æ‰€æœ‰æ´»è·ƒçš„æ™ºèƒ½ä½“
        2. æ¯ä¸ªæ™ºèƒ½ä½“å¯¹æ¶ˆæ¯è¿›è¡Œ"èƒ½åŠ›è‡ªè¯„"ï¼Œè¿”å›ç½®ä¿¡åº¦(0-1)
        3. é€‰æ‹©ç½®ä¿¡åº¦æœ€é«˜çš„æ™ºèƒ½ä½“å¤„ç†
        4. å¦‚æœéƒ½ä½äºé˜ˆå€¼ï¼Œä½¿ç”¨é»˜è®¤æ™ºèƒ½ä½“
        """
        best_agent = None
        best_confidence = 0.0
        
        # éå†æ‰€æœ‰æ™ºèƒ½ä½“ï¼Œè®¡ç®—å¤„ç†ç½®ä¿¡åº¦
        for role, agent in self.agents.items():
            if agent.is_active:
                # æ¯ä¸ªAgentè‡ªè¯„èƒ½åŠ›ï¼Œè¿”å›0-1çš„ç½®ä¿¡åº¦
                confidence = agent.can_handle(message, context)
                
                if confidence > best_confidence:
                    best_confidence = confidence
                    best_agent = agent
        
        # å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ™ºèƒ½ä½“ï¼Œä½¿ç”¨é»˜è®¤æ™ºèƒ½ä½“ï¼ˆå¥åº·ç®¡å®¶ï¼‰
        if best_agent is None and self.default_agent:
            best_agent = self.agents.get(self.default_agent)
            best_confidence = 0.5
        
        return best_agent, best_confidence
    
    def multi_agent_process(self, user_input: str, memory: AgentMemory) -> List[AgentMessage]:
        """
        å¤šæ™ºèƒ½ä½“åä½œ - è®©å¤šä¸ªä¸“å®¶åŒæ—¶ç»™å‡ºå»ºè®®
        
        åº”ç”¨åœºæ™¯ï¼šå¤æ‚é—®é¢˜éœ€è¦å¤šè§’åº¦åˆ†æ
        ä¾‹å¦‚ï¼š"æˆ‘è¡€å‹é«˜è¿˜ç¡ä¸å¥½ï¼Œå¿ƒæƒ…ä¹Ÿä¸å¥½"
        â†’ æ…¢ç—…ä¸“å®¶ + ç”Ÿæ´»æ•™ç»ƒ + å¿ƒç†å…³æ€€å¸ˆ ååŒå›ç­”
        """
        responses = []
        
        for role, agent in self.agents.items():
            if agent.is_active:
                confidence = agent.can_handle(user_message, {})
                # åªé€‰æ‹©ç½®ä¿¡åº¦ â‰¥ 60% çš„æ™ºèƒ½ä½“å‚ä¸
                if confidence >= 0.6:
                    response = agent.process(user_message, memory)
                    responses.append(response)
        
        return responses
    
    def synthesize_responses(self, responses: List, strategy: str = "merge") -> str:
        """
        å“åº”æ•´åˆç­–ç•¥
        
        ç­–ç•¥é€‰é¡¹ï¼š
        - merge: åˆå¹¶å¤šä¸ªå“åº”ï¼ˆé»˜è®¤ï¼‰
        - select_best: é€‰æ‹©æœ€ä¼˜å“åº”
        - weighted: æŒ‰ç½®ä¿¡åº¦åŠ æƒ
        """
        if strategy == "merge":
            return "\n\n---\n\n".join([
                f"**{r.metadata.get('agent_name', '')}çš„å»ºè®®ï¼š**\n{r.content}" 
                for r in responses
            ])
        elif strategy == "select_best":
            return max(responses, key=lambda r: r.metadata.get('confidence', 0)).content
```

**ä»£ç è®²è§£è¦ç‚¹**ï¼š
1. **ç½®ä¿¡åº¦è·¯ç”±**ï¼šæ¯ä¸ªæ™ºèƒ½ä½“è‡ªè¯„å¤„ç†èƒ½åŠ›ï¼Œé€‰æœ€ä¼˜
2. **å¤šAgentåä½œ**ï¼šå¤æ‚é—®é¢˜å¯å¤šæ™ºèƒ½ä½“åŒæ—¶å›ç­”
3. **å“åº”æ•´åˆ**ï¼šæ”¯æŒå¤šç§ç­–ç•¥åˆå¹¶å¤šä¸ªä¸“å®¶æ„è§

---

## å…­ã€æ„å›¾è¯†åˆ«ç³»ç»Ÿ

### 6.1 æ„å›¾åˆ†ç±»

```python
class IntentCategory(Enum):
    """æ„å›¾åˆ†ç±»"""
    GREETING = "greeting"           # é—®å€™
    HEALTH_QUERY = "health_query"   # å¥åº·æŸ¥è¯¢
    CHRONIC_DISEASE = "chronic"     # æ…¢ç—…å’¨è¯¢
    LIFESTYLE = "lifestyle"         # ç”Ÿæ´»æ–¹å¼
    EMOTIONAL = "emotional"         # æƒ…æ„Ÿæ”¯æŒ
    REPORT = "report"               # æŠ¥å‘Šç”Ÿæˆ
    UNKNOWN = "unknown"             # æœªçŸ¥
```

### 6.2 å…³é”®è¯åŒ¹é… + ç½®ä¿¡åº¦è®¡ç®—

```python
class IntentRecognizer:
    """æ„å›¾è¯†åˆ«å™¨"""
    
    def __init__(self):
        # æ„å›¾å…³é”®è¯åº“
        self.intent_keywords = {
            IntentCategory.CHRONIC_DISEASE: [
                "è¡€å‹", "è¡€ç³–", "è¡€è„‚", "é«˜è¡€å‹", "ç³–å°¿ç—…", 
                "å¿ƒè„", "èƒ†å›ºé†‡", "é™å‹è¯", "é™ç³–è¯"
            ],
            IntentCategory.LIFESTYLE: [
                "è¿åŠ¨", "ç¡çœ ", "é¥®é£Ÿ", "å‡è‚¥", "é”»ç‚¼", 
                "èµ°è·¯", "æ­¥æ•°", "å¤±çœ ", "åƒé¥­"
            ],
            IntentCategory.EMOTIONAL: [
                "ç„¦è™‘", "æ‹…å¿ƒ", "å®³æ€•", "å­¤ç‹¬", "éš¾è¿‡",
                "å¿ƒæƒ…", "å‹åŠ›", "çƒ¦èº", "æƒ³å¿µ"
            ],
            IntentCategory.GREETING: [
                "ä½ å¥½", "æ—©ä¸Šå¥½", "ä¸‹åˆå¥½", "æ™šä¸Šå¥½", "åœ¨å—"
            ]
        }
    
    def recognize(self, text: str) -> Tuple[IntentCategory, float]:
        """
        è¯†åˆ«ç”¨æˆ·æ„å›¾
        
        è¿”å›: (æ„å›¾ç±»åˆ«, ç½®ä¿¡åº¦)
        """
        max_score = 0.0
        best_intent = IntentCategory.UNKNOWN
        
        for intent, keywords in self.intent_keywords.items():
            score = self._calculate_match_score(text, keywords)
            if score > max_score:
                max_score = score
                best_intent = intent
        
        return best_intent, max_score
    
    def _calculate_match_score(self, text: str, keywords: List[str]) -> float:
        """è®¡ç®—å…³é”®è¯åŒ¹é…å¾—åˆ†"""
        matches = sum(1 for kw in keywords if kw in text)
        return min(matches * 0.3, 1.0)  # æ¯åŒ¹é…ä¸€ä¸ª+0.3ï¼Œæœ€é«˜1.0
```

---

## ä¸ƒã€RAG çŸ¥è¯†åº“ç³»ç»Ÿ

### 7.1 æŠ€æœ¯å‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| **å‘é‡åŒ–æ¨¡å‹** | `moka-ai/m3e-base` | ä¸­æ–‡è¯­ä¹‰ç†è§£ä¼˜åŒ– |
| **å‘é‡ç»´åº¦** | 768 ç»´ | æ¨¡å‹è¾“å‡ºç»´åº¦ |
| **Chunk Size** | 500 å­—ç¬¦ | æ–‡æ¡£åˆ†å—å¤§å° |
| **å‘é‡æ£€ç´¢** | FAISS IndexFlatIP | å†…ç§¯ç›¸ä¼¼åº¦ |
| **Top-K** | 5 | è¿”å›æœ€ç›¸å…³çš„5æ¡ |

### 7.2 RAG å·¥ä½œæµç¨‹

```
ç”¨æˆ·é—®é¢˜ â†’ m3e-baseå‘é‡åŒ– â†’ FAISSæ£€ç´¢ â†’ Top-KçŸ¥è¯† â†’ LLMç”Ÿæˆç­”æ¡ˆ
                                â†“
                         çŸ¥è¯†åº“æ–‡æ¡£åº“
                         â”œâ”€â”€ æ…¢ç—…ç®¡ç†.md
                         â”œâ”€â”€ ç”¨è¯æŒ‡å¯¼.md
                         â”œâ”€â”€ é¥®é£Ÿå»ºè®®.md
                         â””â”€â”€ è¿åŠ¨æŒ‡å—.md
```

### 7.3 æ ¸å¿ƒæ£€ç´¢ä»£ç 

```python
class KnowledgeBase:
    """RAGçŸ¥è¯†åº“ - å‘é‡æ£€ç´¢å¢å¼ºç”Ÿæˆ"""
    
    def __init__(self):
        # ä½¿ç”¨ä¸­æ–‡ä¼˜åŒ–çš„ m3e-base æ¨¡å‹
        self.embedding_model = SentenceTransformer("moka-ai/m3e-base")
        self.embedding_dim = 768
        self.index = None
        self.metadata = []
    
    def add_document(self, content: str, metadata: Dict):
        """æ·»åŠ æ–‡æ¡£åˆ°çŸ¥è¯†åº“"""
        # 1. æ–‡æ¡£åˆ†å—
        chunks = self._split_text(content, chunk_size=500)
        
        # 2. å‘é‡åŒ–
        embeddings = self.embedding_model.encode(chunks)
        
        # 3. æ·»åŠ åˆ°FAISSç´¢å¼•
        if self.index is None:
            self.index = faiss.IndexFlatIP(self.embedding_dim)
        self.index.add(embeddings.astype('float32'))
    
    def search(self, query: str, top_k: int = 5) -> List[Dict]:
        """
        è¯­ä¹‰æ£€ç´¢ - æ‰¾åˆ°æœ€ç›¸å…³çš„çŸ¥è¯†
        
        æŠ€æœ¯äº®ç‚¹ï¼š
        1. å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ï¼Œç†è§£è¯­ä¹‰è€Œéå…³é”®è¯
        2. FAISSé«˜æ•ˆç´¢å¼•ï¼Œæ¯«ç§’çº§å“åº”
        3. è¿”å›ç›¸ä¼¼åº¦åˆ†æ•°ï¼Œå¯ç”¨äºè¿‡æ»¤
        """
        # ç”ŸæˆæŸ¥è¯¢å‘é‡
        query_embedding = self.embedding_model.encode([query])[0]
        query_embedding = query_embedding.reshape(1, -1).astype('float32')
        
        # FAISS ç›¸ä¼¼åº¦æœç´¢
        scores, indices = self.index.search(query_embedding, top_k)
        
        # ç»„è£…ç»“æœ
        results = []
        for score, idx in zip(scores[0], indices[0]):
            if idx < len(self.metadata):
                result = self.metadata[idx].copy()
                result["similarity_score"] = float(score)
                results.append(result)
        
        return results
```

---

## å…«ã€ä¸ä¼ ç»Ÿå•Agentå¯¹æ¯”

| å¯¹æ¯”é¡¹ | å• Agent | å¤š Agent åä½œï¼ˆæœ¬é¡¹ç›®ï¼‰ |
|--------|----------|------------------------|
| **æ¶æ„** | ä¸€ä¸ªå¤§æ¨¡å‹å¤„ç†æ‰€æœ‰ä»»åŠ¡ | 4 ä¸ªä¸“ä¸šæ™ºèƒ½ä½“ + åè°ƒå™¨ |
| **ä¸“ä¸šæ€§** | é€šç”¨å›ç­”ï¼Œä¸å¤Ÿç²¾å‡† | æ…¢ç—…ä¸“å®¶å†…ç½®åŒ»å­¦æ ‡å‡† |
| **å¯æ‰©å±•æ€§** | æ–°å¢åŠŸèƒ½éœ€ä¿®æ”¹æ¨¡å‹ | æ–°å¢ Agent å³æ’å³ç”¨ |
| **å®¹é”™æ€§** | å•ç‚¹æ•…éšœ | å…¶ä»– Agent å¯æ¥ç®¡ |
| **å“åº”æ•´åˆ** | å•ä¸€è¾“å‡º | æ”¯æŒå¤šç­–ç•¥èåˆ |
| **å¯è§£é‡Šæ€§** | é»‘ç›’ | å¯è¿½è¸ªå“ªä¸ªAgentå¤„ç† |

---

## ä¹ã€æŠ€æœ¯äº®ç‚¹æ€»ç»“

| äº®ç‚¹ | è¯´æ˜ |
|------|------|
| **å¤šæ™ºèƒ½ä½“åä½œ** | 4ä¸ªä¸“ä¸šæ™ºèƒ½ä½“ + 1ä¸ªåè°ƒå™¨ï¼Œåˆ†å·¥æ˜ç¡® |
| **ç½®ä¿¡åº¦è·¯ç”±** | è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„æ™ºèƒ½ä½“å¤„ç†é—®é¢˜ |
| **è®°å¿†ç³»ç»Ÿ** | çŸ­æœŸå¯¹è¯è®°å¿† + é•¿æœŸç”¨æˆ·ç”»åƒ |
| **RAGå¢å¼º** | FAISSå‘é‡æ£€ç´¢ + åŒ»å­¦çŸ¥è¯†åº“ |
| **å¯æ‰©å±•æ¶æ„** | æ–°å¢æ™ºèƒ½ä½“åªéœ€ç»§æ‰¿BaseAgent |

---

## åã€ä¾èµ–åº“

```txt
# å‘é‡æ£€ç´¢
faiss-cpu>=1.7.0         # Facebookå‘é‡æ£€ç´¢åº“
sentence-transformers    # æ–‡æœ¬å‘é‡åŒ–
# æ¨¡å‹: moka-ai/m3e-base  # ä¸­æ–‡ä¼˜åŒ–åµŒå…¥æ¨¡å‹

# æ•°æ®å¤„ç†
numpy>=1.21.0
pydantic>=2.0.0          # æ•°æ®éªŒè¯

# Webæ¡†æ¶
fastapi>=0.100.0
```

---

*æ–‡æ¡£æ›´æ–°æ—¶é—´: 2025å¹´12æœˆ*
*é¡¹ç›®: å…»ç”Ÿä¹‹é“æ™ºèƒ½å¥åº·ç®¡ç†ç³»ç»Ÿ*
