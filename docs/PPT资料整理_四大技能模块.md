# ğŸ“Š PPT èµ„æ–™æ•´ç† - å››å¤§æŠ€èƒ½æ¨¡å—

> æ•´ç†æ—¥æœŸï¼š2024-12-07  
> ç”¨é€”ï¼šäº’è”ç½‘+/æŒ‘æˆ˜æ¯ç­‰æ¯”èµ› PPT åˆ¶ä½œèµ„æ–™æ”¯æ’‘

---

## ğŸ”§ æŠ€èƒ½å±•ç¤º1ï¼šæ•°æ®é‡‡é›†ä¸æ¸…æ´— (Slides 10-11)

### P10ï¼šæ•°æ®é‡‡é›†

#### 1. ç¡¬ä»¶è¿æ¥å›¾/ç¤ºæ„å›¾
**éœ€è¦ä½ æä¾›çš„èµ„æ–™**ï¼š
- [ ] MAX30102 ä¼ æ„Ÿå™¨ä¸ ESP32/STM32 çš„æ¥çº¿å›¾ï¼ˆI2C æ¥å£ï¼‰
- [ ] æˆ–ä½¿ç”¨ä»¥ä¸‹æ–‡å­—æè¿°æ›¿ä»£

**å‚è€ƒæè¿°**ï¼ˆå¦‚æ— å®é™…ç¡¬ä»¶ï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      I2C (SDA/SCL)      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MAX30102      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   ESP32      â”‚
â”‚ å¿ƒç‡è¡€æ°§ä¼ æ„Ÿå™¨  â”‚                         â”‚  å¼€å‘æ¿      â”‚
â”‚ VCC GND SDA SCL â”‚                         â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚ WiFi/MQTT
                                                   â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚ FastAPIåç«¯  â”‚
                                          â”‚ (äº‘æœåŠ¡å™¨)   â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. é€šä¿¡åè®®ä¸ç½‘ç»œæ‹“æ‰‘
**ä»£ç è¯æ®** - æ•°æ®ä¸Šä¼ æ–¹å¼ä¸º HTTP POSTï¼š

```python
# æ¥æºï¼šfrontend/src/services/healthDataApi.ts
const API_BASE_URL = 'http://localhost:8000';

// å¥åº·æ•°æ®é€šè¿‡ HTTP POST ä¸Šä¼ åˆ° FastAPI åç«¯
export async function getTodayHealthData(userId: string) {
  const response = await fetch(`${API_BASE_URL}/api/health/today?user_id=${userId}`);
  return response.json();
}
```

**æŠ€æœ¯æ ˆ**ï¼šHTTP REST API â†’ FastAPI åç«¯ â†’ SQLite/PostgreSQL æ•°æ®åº“

---

### P11ï¼šæ•°æ®æ¸…æ´—

#### 1. æ•°æ®æ¸…æ´—ä»£ç æˆªå›¾
**ä»£ç æ¥æº**ï¼š`frontend/health_assessment_system/core/data_pipeline.py`

```python
# IQR å››åˆ†ä½è·æ³• - å¼‚å¸¸å€¼è¿‡æ»¤
def _iqr_filter(self, arr: np.ndarray) -> np.ndarray:
    """IQRå¼‚å¸¸å€¼è¿‡æ»¤"""
    q1 = np.percentile(arr, 25)
    q3 = np.percentile(arr, 75)
    iqr = q3 - q1
    lower = q1 - self.iqr_multiplier * iqr  # é»˜è®¤ 1.5
    upper = q3 + self.iqr_multiplier * iqr
    return (arr >= lower) & (arr <= upper)

# Z-score æ ‡å‡†å·®æ³• - å¼‚å¸¸å€¼è¿‡æ»¤
def _zscore_filter(self, arr: np.ndarray) -> np.ndarray:
    """Z-scoreå¼‚å¸¸å€¼è¿‡æ»¤"""
    mean = np.mean(arr)
    std = np.std(arr)
    z_scores = np.abs((arr - mean) / std) if std > 0 else np.zeros_like(arr)
    return z_scores < self.zscore_threshold  # é»˜è®¤é˜ˆå€¼ 3.0
```

**ä¸šåŠ¡è§„åˆ™è¿‡æ»¤**ï¼ˆåŒ»å­¦åˆç†èŒƒå›´ï¼‰ï¼š
```python
self.business_rules = {
    'blood_pressure': {'systolic': (70, 200), 'diastolic': (40, 130)},
    'glucose': {'value': (2.0, 30.0)},
    'heart_rate': {'value': (35, 200)},       # å¿ƒç‡ 35-200 bpm
    'temperature': {'value': (35.0, 41.0)},   # ä½“æ¸© 35-41 Â°C
    'spo2': {'value': (75, 100)}              # è¡€æ°§ 75-100%
}
```

#### 2. æ¸…æ´—æ•ˆæœå¯¹æ¯”å›¾
**éœ€è¦ä½ æä¾›çš„èµ„æ–™**ï¼š
- [ ] åŸå§‹é‡‡é›†æ•°æ®æ³¢å½¢å›¾ï¼ˆå¸¦æ¯›åˆº/è·³åŠ¨ï¼‰
- [ ] æ¸…æ´—åæ•°æ®æ³¢å½¢å›¾ï¼ˆå¹³æ»‘æ›²çº¿ï¼‰
- [ ] å¦‚æ— æ³•æä¾›ï¼Œå¯ç”¨ä»¥ä¸‹ç¤ºæ„

**æ¸…æ´—æµç¨‹å›¾**ï¼š
```
åŸå§‹æ•°æ® â†’ å»é‡ â†’ ä¸šåŠ¡è§„åˆ™è¿‡æ»¤ â†’ IQR/Z-scoreå¼‚å¸¸æ£€æµ‹ â†’ ç¼ºå¤±å€¼å¡«å…… â†’ æ ‡å‡†åŒ– â†’ å¹²å‡€æ•°æ®
         â†“        â†“                  â†“                    â†“            â†“
      å»é™¤2%    è¿‡æ»¤è¶…èŒƒå›´å€¼      è¿‡æ»¤ç»Ÿè®¡å¼‚å¸¸å€¼       çº¿æ€§æ’å€¼    Min-Maxå½’ä¸€åŒ–
```

---

## ğŸ“ˆ æŠ€èƒ½å±•ç¤º2ï¼šæ•°æ®åˆ†æä¸å¯è§†åŒ–å¤„ç† (Slides 12-13)

### P12ï¼šæŠ€æœ¯å®ç°

#### 1. å¯è§†åŒ–ä»£ç ç‰‡æ®µ
**ä»£ç æ¥æº**ï¼š`frontend/src/components/dashboard/HealthCharts.tsx`

```tsx
import { LineChart, Line, AreaChart, Area, BarChart, Bar, 
         RadarChart, Radar, XAxis, YAxis, CartesianGrid, 
         Tooltip, ResponsiveContainer } from 'recharts';

// ä» FastAPI è·å–æ•°æ®å¹¶æ¸²æŸ“å›¾è¡¨
function useChartData(userId: string = 'demo') {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    const fetchData = async () => {
      const result = await getChartData(userId, 7);  // è·å–7å¤©æ•°æ®
      if (result.success && result.data) {
        setData(result.data);
      }
    };
    fetchData();
    const interval = setInterval(fetchData, 60000);  // æ¯åˆ†é’Ÿåˆ·æ–°
    return () => clearInterval(interval);
  }, [userId]);
  
  return { data };
}

// å¿ƒç‡è¶‹åŠ¿å›¾æ¸²æŸ“
<ResponsiveContainer width="100%" height={300}>
  <LineChart data={heartRateData}>
    <CartesianGrid strokeDasharray="3 3" />
    <XAxis dataKey="time" />
    <YAxis domain={[50, 100]} />
    <Tooltip />
    <Line type="monotone" dataKey="value" stroke="#ef4444" strokeWidth={2} />
    <ReferenceLine y={60} stroke="#22c55e" strokeDasharray="5 5" label="æ­£å¸¸ä¸‹é™" />
    <ReferenceLine y={100} stroke="#f59e0b" strokeDasharray="5 5" label="æ­£å¸¸ä¸Šé™" />
  </LineChart>
</ResponsiveContainer>
```

#### 2. æ•°æ®å¤„ç†æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP GET    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    JSON    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ React Fetch â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ React State â”‚
â”‚ åç«¯ API    â”‚                â”‚ healthData  â”‚            â”‚ useState    â”‚
â”‚ /api/health â”‚                â”‚ Api.ts      â”‚            â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                                 â”‚
                                                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Recharts ç»„ä»¶æ¸²æŸ“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ LineChartâ”‚  â”‚ BarChart â”‚  â”‚ PieChart â”‚  â”‚RadarChartâ”‚                 â”‚
â”‚  â”‚ å¿ƒç‡è¶‹åŠ¿ â”‚  â”‚ ç¡çœ åˆ†æ â”‚  â”‚ å¹´é¾„åˆ†å¸ƒ â”‚  â”‚ å¥åº·é›·è¾¾ â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### P13ï¼šå¯è§†åŒ–æˆæœ

#### 1. ç¤¾åŒºå¤§å±/å‘Šè­¦ç®¡ç†æˆªå›¾
**æˆªå›¾ä½ç½®**ï¼šè¯·å¯åŠ¨å‰ç«¯åè®¿é—® `ç¤¾åŒºç«¯ â†’ æ•°æ®å¤§å±`
- æ–‡ä»¶ï¼š`frontend/src/components/community/BigScreenDashboard.tsx`

**å¤§å±åŠŸèƒ½**ï¼š
- å››ä¸ªä¸»è¦ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»äººæ•°ã€ç›‘æµ‹äººæ•°ã€å‘Šè­¦æ•°ã€è®¾å¤‡æ•°ï¼‰
- å¹´é¾„åˆ†å¸ƒé¥¼å›¾
- å¥åº·è¶‹åŠ¿æŠ˜çº¿å›¾ï¼ˆ7å¤©æ•°æ®ï¼‰
- 2Dæ•°å­—å­ªç”Ÿåœ°å›¾ï¼ˆæ˜¾ç¤ºè€äººä½ç½®å’Œå‘Šè­¦ï¼‰
- å®æ—¶æ—¶é’Ÿæ˜¾ç¤º

#### 2. å‘Šè­¦æ—¥å¿—åˆ—è¡¨
**ä»£ç æ¥æº**ï¼š`frontend/src/components/community/AlertManagement.tsx`

```javascript
// ç¤ºä¾‹å‘Šè­¦æ•°æ®
const alertsData = [
  {
    id: '1',
    level: 'critical',
    name: 'èµµé˜¿å§¨',
    age: 70,
    issue: 'è¡€å‹æŒç»­åé«˜',
    value: '145/95 mmHg',
    duration: 'æŒç»­3å¤©',
    time: '10åˆ†é’Ÿå‰',
    suggestions: ['ç«‹å³è”ç³»å®¶å±', 'é¢„çº¦ç¤¾åŒºåŒ»ç”Ÿ', 'è°ƒæ•´é™å‹è¯ç‰©'],
  },
  {
    id: '2',
    level: 'critical',
    name: 'ç‹å¤§çˆ·',
    age: 75,
    issue: 'å¿ƒç‡å¼‚å¸¸',
    value: '105 bpm',
    duration: '1å¤©',
    time: '25åˆ†é’Ÿå‰',
  },
  // ... æ›´å¤šå‘Šè­¦
];
```

---

## ğŸ¤– æŠ€èƒ½å±•ç¤º3ï¼šAIæ™ºèƒ½ä½“æ­å»º (Slides 14-15)

### P14ï¼šå¤š Agent åä½œæ¶æ„ â­æŠ€æœ¯äº®ç‚¹

#### 1. å¤šæ™ºèƒ½ä½“åä½œæµç¨‹å›¾
```
                              ç”¨æˆ·è¾“å…¥
                                  â”‚
                                  â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   AgentCoordinator    â”‚
                      â”‚      æ™ºèƒ½ä½“åè°ƒå™¨      â”‚
                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                      â”‚  â”‚ æ„å›¾è¯†åˆ« & è·¯ç”±  â”‚  â”‚
                      â”‚  â”‚ ç½®ä¿¡åº¦è¯„åˆ†æœºåˆ¶   â”‚  â”‚
                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚                       â”‚
          â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ  å¥åº·ç®¡å®¶     â”‚   â”‚  ğŸ©º æ…¢ç—…ä¸“å®¶     â”‚   â”‚  ğŸƒ ç”Ÿæ´»æ•™ç»ƒ     â”‚
â”‚  HealthButler   â”‚   â”‚ ChronicExpert   â”‚   â”‚ LifestyleCoach  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Â· æ—¥å¸¸å¥åº·é—®ç­”  â”‚   â”‚  Â· é«˜è¡€å‹åˆ†æ   â”‚   â”‚  Â· è¿åŠ¨å¤„æ–¹     â”‚
â”‚  Â· æ•°æ®è§£è¯»     â”‚   â”‚  Â· ç³–å°¿ç—…ç®¡ç†   â”‚   â”‚  Â· é¥®é£ŸæŒ‡å¯¼     â”‚
â”‚  Â· å¥åº·æé†’     â”‚   â”‚  Â· è¡€è„‚è¯„ä¼°     â”‚   â”‚  Â· ç¡çœ ä¼˜åŒ–     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                       â”‚                       â”‚
          â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
          â”‚           â”‚  ğŸ’š å¿ƒç†å…³æ€€å¸ˆ    â”‚               â”‚
          â”‚           â”‚  EmotionalCare   â”‚               â”‚
          â”‚           â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚               â”‚
          â”‚           â”‚  Â· æƒ…ç»ªè¯†åˆ«      â”‚               â”‚
          â”‚           â”‚  Â· å¿ƒç†ç–å¯¼      â”‚               â”‚
          â”‚           â”‚  Â· é™ªä¼´å…³æ€€      â”‚               â”‚
          â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
          â”‚                       â”‚                       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   Response Synthesis  â”‚
                      â”‚      å“åº”æ•´åˆç­–ç•¥      â”‚
                      â”‚  Â· merge: åˆå¹¶å¤šå“åº”  â”‚
                      â”‚  Â· select_best: æœ€ä¼˜  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   AgentMemory è®°å¿†    â”‚
                      â”‚  Â· çŸ­æœŸ: å¯¹è¯å†å²     â”‚
                      â”‚  Â· é•¿æœŸ: ç”¨æˆ·ç”»åƒ     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. ä¸ä¼ ç»Ÿå• Agent å¯¹æ¯”
| å¯¹æ¯”é¡¹ | å• Agent | å¤š Agent åä½œï¼ˆæœ¬é¡¹ç›®ï¼‰ |
|--------|----------|------------------------|
| **æ¶æ„** | ä¸€ä¸ªå¤§æ¨¡å‹å¤„ç†æ‰€æœ‰ä»»åŠ¡ | 4 ä¸ªä¸“ä¸šæ™ºèƒ½ä½“ + åè°ƒå™¨ |
| **ä¸“ä¸šæ€§** | é€šç”¨å›ç­”ï¼Œä¸å¤Ÿç²¾å‡† | æ…¢ç—…ä¸“å®¶å†…ç½®åŒ»å­¦æ ‡å‡† |
| **å¯æ‰©å±•æ€§** | æ–°å¢åŠŸèƒ½éœ€ä¿®æ”¹æ¨¡å‹ | æ–°å¢ Agent å³æ’å³ç”¨ |
| **å®¹é”™æ€§** | å•ç‚¹æ•…éšœ | å…¶ä»– Agent å¯æ¥ç®¡ |
| **å“åº”æ•´åˆ** | å•ä¸€è¾“å‡º | æ”¯æŒå¤šç­–ç•¥èåˆ |

#### 3. æ™ºèƒ½ä½“è·¯ç”±æœºåˆ¶ä»£ç 
**ä»£ç æ¥æº**ï¼š`frontend/health_assessment_system/agents/agent_coordinator.py`

```python
def route_message(self, message: AgentMessage, context: Dict) -> Tuple[BaseAgent, float]:
    """
    è·¯ç”±æ¶ˆæ¯åˆ°æœ€åˆé€‚çš„æ™ºèƒ½ä½“ - åŸºäºç½®ä¿¡åº¦è¯„åˆ†æœºåˆ¶
    """
    best_agent = None
    best_confidence = 0.0
    
    # éå†æ‰€æœ‰æ™ºèƒ½ä½“ï¼Œè®¡ç®—å¤„ç†ç½®ä¿¡åº¦
    for role, agent in self.agents.items():
        if agent.is_active:
            confidence = agent.can_handle(message, context)  # æ¯ä¸ªAgentè‡ªè¯„èƒ½åŠ›
            if confidence > best_confidence:
                best_confidence = confidence
                best_agent = agent
    
    # å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ™ºèƒ½ä½“ï¼Œä½¿ç”¨é»˜è®¤æ™ºèƒ½ä½“ï¼ˆå¥åº·ç®¡å®¶ï¼‰
    if best_agent is None and self.default_agent:
        best_agent = self.agents.get(self.default_agent)
    
    return best_agent, best_confidence
```

---

### P15ï¼šä¸“å®¶ Agent + RAG çŸ¥è¯†å¢å¼º

#### 1. æ…¢ç—…ä¸“å®¶æ™ºèƒ½ä½“ï¼ˆå†…ç½®åŒ»å­¦æ ‡å‡†ï¼‰
**ä»£ç æ¥æº**ï¼š`frontend/health_assessment_system/agents/chronic_disease_expert.py`

```python
class ChronicDiseaseExpertAgent(BaseAgent):
    """æ…¢ç—…ä¸“å®¶æ™ºèƒ½ä½“ - å†…ç½®ä¸­å›½åŒ»å­¦æŒ‡å—æ ‡å‡†"""
    
    def __init__(self):
        # è¡€å‹åˆ†çº§æ ‡å‡†ï¼ˆå‚è€ƒã€Šä¸­å›½é«˜è¡€å‹é˜²æ²»æŒ‡å—ã€‹ï¼‰
        self.bp_grades = {
            "æ­£å¸¸": {"systolic": (0, 120), "diastolic": (0, 80)},
            "æ­£å¸¸é«˜å€¼": {"systolic": (120, 140), "diastolic": (80, 90)},
            "1çº§é«˜è¡€å‹": {"systolic": (140, 160), "diastolic": (90, 100)},
            "2çº§é«˜è¡€å‹": {"systolic": (160, 180), "diastolic": (100, 110)},
            "3çº§é«˜è¡€å‹": {"systolic": (180, 999), "diastolic": (110, 999)}
        }
        
        # è¡€ç³–æ ‡å‡†ï¼ˆå‚è€ƒã€Šä¸­å›½2å‹ç³–å°¿ç—…é˜²æ²»æŒ‡å—ã€‹ï¼‰
        self.glucose_standards = {
            "æ­£å¸¸": {"fasting": (3.9, 6.1), "postprandial": (0, 7.8)},
            "ç³–è€é‡å—æŸ": {"fasting": (6.1, 7.0), "postprandial": (7.8, 11.1)},
            "ç³–å°¿ç—…": {"fasting": (7.0, 999), "postprandial": (11.1, 999)}
        }
        
        self.capabilities = ["é«˜è¡€å‹è¯„ä¼°", "ç³–å°¿ç—…è¯„ä¼°", "è¡€è„‚è¯„ä¼°", "å¿ƒè¡€ç®¡é£é™©è¯„ä¼°"]
```

#### 2. å¤šæ™ºèƒ½ä½“åä½œå¤„ç†
**ä»£ç æ¥æº**ï¼š`frontend/health_assessment_system/agents/agent_coordinator.py`

```python
def multi_agent_process(self, user_input: str, memory: AgentMemory) -> List[AgentMessage]:
    """å¤šæ™ºèƒ½ä½“åä½œ - è®©å¤šä¸ªä¸“å®¶åŒæ—¶ç»™å‡ºå»ºè®®"""
    responses = []
    
    for role, agent in self.agents.items():
        if agent.is_active:
            confidence = agent.can_handle(user_message, {})
            if confidence >= 0.6:  # åªé€‰æ‹©ç½®ä¿¡åº¦ â‰¥ 60% çš„æ™ºèƒ½ä½“
                response = agent.process(user_message, memory)
                responses.append(response)
    
    return responses

def synthesize_responses(self, responses, strategy="merge") -> str:
    """å“åº”æ•´åˆç­–ç•¥ï¼šmergeï¼ˆåˆå¹¶ï¼‰ã€select_bestï¼ˆæœ€ä¼˜ï¼‰"""
    if strategy == "merge":
        return "\n\n---\n\n".join([
            f"**{agent_name}çš„å»ºè®®ï¼š**\n{r.content}" for r in responses
        ])
```

#### 3. RAG çŸ¥è¯†åº“æ£€ç´¢
| å‚æ•° | å€¼ |
|------|-----|
| **å‘é‡åŒ–æ¨¡å‹** | `moka-ai/m3e-base` (ä¸­æ–‡ä¼˜åŒ–) |
| **å‘é‡ç»´åº¦** | 768 ç»´ |
| **Chunk Size** | 500 å­—ç¬¦ |
| **å‘é‡æ£€ç´¢** | FAISS IndexFlatIP |

**ä»£ç æ¥æº**ï¼š`backend/services/knowledge_base.py`

```python
def search(self, query: str, top_k: int = 5) -> List[Dict[str, Any]]:
    # ç”ŸæˆæŸ¥è¯¢å‘é‡
    query_embedding = self._get_embedding(query).reshape(1, -1)
    
    # FAISS ç›¸ä¼¼åº¦æœç´¢
    scores, indices = self.index.search(query_embedding, top_k)
    
    # è¿”å›æœ€ç›¸å…³çš„æ–‡æ¡£å—
    return [{"content": ..., "similarity_score": score} for score, idx in zip(scores[0], indices[0])]
```

---

## ğŸ¤ æŠ€èƒ½å±•ç¤º4ï¼šè¯­éŸ³äº¤äº’ (Slides 16-17)

### P16ï¼šæŠ€æœ¯æµç¨‹

#### 1. è¯­éŸ³äº¤äº’æŠ€æœ¯æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¯­éŸ³    â”‚â”€â”€â”€â–ºâ”‚  FunASR     â”‚â”€â”€â”€â–ºâ”‚  æ„å›¾è¯†åˆ«   â”‚â”€â”€â”€â–ºâ”‚  DeepSeek   â”‚
â”‚  è¾“å…¥        â”‚    â”‚ SenseVoice  â”‚    â”‚  æ–‡å­—å¤„ç†   â”‚    â”‚  AI å›å¤    â”‚
â”‚  (éº¦å…‹é£)    â”‚    â”‚  è¯­éŸ³â†’æ–‡å­—  â”‚    â”‚             â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                                â”‚
                                                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯­éŸ³æ’­æ”¾    â”‚â—„â”€â”€â”€â”‚  Edge-TTS   â”‚â—„â”€â”€â”€â”‚   æ–‡å­—      â”‚â—„â”€â”€â”€â”‚  FastAPI    â”‚
â”‚  (æ‰¬å£°å™¨)    â”‚    â”‚  è¯­éŸ³åˆæˆ   â”‚    â”‚   å›å¤      â”‚    â”‚  åç«¯å¤„ç†   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. FunASR / Edge-TTS é…ç½®ä»£ç 
**ä»£ç æ¥æº**ï¼š`backend/services/voice_service.py`

```python
# Edge-TTS è¯­éŸ³åˆæˆé…ç½®
class VoiceService:
    # ä¸­æ–‡è¯­éŸ³åˆ—è¡¨ï¼ˆé€‚è€åŒ–é€‰æ‹©ï¼‰
    VOICES = {
        "xiaoxiao": "zh-CN-XiaoxiaoNeural",  # å¥³å£°ï¼Œæ¸©æŸ”ï¼ˆæ¨èï¼‰
        "yunxi": "zh-CN-YunxiNeural",        # ç”·å£°ï¼Œå¹´è½»
        "yunyang": "zh-CN-YunyangNeural",    # ç”·å£°ï¼Œæ–°é—»æ’­æŠ¥
    }
    
    async def text_to_speech(
        self,
        text: str,
        voice: str = "xiaoxiao",  # é»˜è®¤æ¸©æŸ”å¥³å£°
        rate: str = "+0%",        # æ­£å¸¸è¯­é€Ÿ
        volume: str = "+10%"      # éŸ³é‡ç¨å¤§ï¼ˆé€‚è€åŒ–ï¼‰
    ):
        voice_name = self.VOICES.get(voice, self.VOICES["xiaoxiao"])
        
        # ä½¿ç”¨ Edge-TTS ç”Ÿæˆè¯­éŸ³
        communicate = edge_tts.Communicate(
            text=text,
            voice=voice_name,
            rate=rate,
            volume=volume
        )
        await communicate.save(audio_path)


# FunASR (SenseVoice) è¯­éŸ³è¯†åˆ«é…ç½®
def _init_asr(self):
    from funasr import AutoModel
    self.asr_model = AutoModel(
        model="iic/SenseVoiceSmall",
        vad_model="fsmn-vad",
        vad_kwargs={"max_single_segment_time": 30000},
        trust_remote_code=True,
        device="cuda:0"  # GPU åŠ é€Ÿ
    )
```

---

### P17ï¼šé€‚è€åŒ–ä½“éªŒ

#### 1. è¯­éŸ³äº¤äº’ç•Œé¢æˆªå›¾
**æˆªå›¾ä½ç½®**ï¼šè¯·å¯åŠ¨å‰ç«¯åè®¿é—® `è€äººç«¯ â†’ ç‚¹å‡»æ‚¬æµ®AIåŠ©æ‰‹`
- æ–‡ä»¶ï¼š`frontend/src/components/elderly/FloatingAIAssistant.tsx`

**é€‚è€åŒ–è®¾è®¡äº®ç‚¹**ï¼š
- å¤§æŒ‰é’®ï¼ˆ120px æ‚¬æµ®çƒï¼‰
- å¤§å­—ä½“ï¼ˆæ ‡é¢˜ 64pxï¼Œæ­£æ–‡ 36px+ï¼‰
- å®æ—¶æ–‡å­—è½¬å†™æ˜¾ç¤º
- è¯­éŸ³æ’­æŠ¥åŠŸèƒ½ï¼ˆå¯æ‹–åŠ¨è°ƒæ•´ä½ç½®ï¼‰

#### 2. æ ‡å‡†éµå¾ªè¯æ®
**ä»£ç æ¥æº**ï¼š`frontend/src/components/login/ElderlyLoginPage.tsx`

```tsx
// é€‚è€åŒ– UI è®¾è®¡ - ç¬¦åˆ GB/T 37668-2019 æ— éšœç¢æ ‡å‡†

// 1. å¤§å­—ä½“è®¾è®¡
<CardTitle className="text-[64px] font-bold">è€äººç«¯ç™»å½•</CardTitle>
<p className="text-[36px]">ä¸ªäººå¥åº·ç›‘æµ‹ä¸ç®¡ç†</p>

// 2. å¤§æŒ‰é’®è®¾è®¡
<Button className="w-full text-[48px] py-16">ç™»å½•ç³»ç»Ÿ</Button>

// 3. è¯­éŸ³æ’­æŠ¥ï¼ˆè¾ƒæ…¢è¯­é€Ÿï¼‰
const speak = (text: string) => {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'zh-CN';
  utterance.rate = 0.8;  // è¯­é€Ÿé™ä½20%ï¼Œé€‚åˆè€å¹´äºº
  window.speechSynthesis.speak(utterance);
};

// 4. è¿›å…¥é¡µé¢è‡ªåŠ¨æ’­æŠ¥
useEffect(() => {
  speak('æ¬¢è¿ä½¿ç”¨æ™ºæ…§å¥åº·ç®¡ç†ç³»ç»Ÿè€äººç«¯ï¼Œè¯·è¾“å…¥æ‚¨çš„è´¦å·å’Œå¯†ç ');
}, []);
```

**éµå¾ªæ ‡å‡†å£°æ˜**ï¼ˆå¯ç”¨äº PPTï¼‰ï¼š
> æœ¬ç³»ç»Ÿé€‚è€åŒ–è®¾è®¡éµå¾ª **å·¥ä¿¡éƒ¨ã€Šäº’è”ç½‘åº”ç”¨é€‚è€åŒ–åŠæ— éšœç¢æ”¹é€ é€šç”¨è®¾è®¡è§„èŒƒã€‹** åŠ **GB/T 37668-2019ã€Šä¿¡æ¯æŠ€æœ¯ äº’è”ç½‘å†…å®¹æ— éšœç¢å¯è®¿é—®æ€§æŠ€æœ¯è¦æ±‚ä¸æµ‹è¯•æ–¹æ³•ã€‹**ï¼Œå®ç°äº†ï¼š
> - å¤§å­—ä½“ UIï¼ˆæ­£æ–‡ â‰¥ 36pxï¼‰
> - è¯­éŸ³æ’­æŠ¥ä¸è¯­éŸ³è¾“å…¥
> - é«˜å¯¹æ¯”åº¦é…è‰²
> - ç®€åŒ–äº¤äº’æµç¨‹

---

## ğŸ“‹ éœ€è¦ä½ è¡¥å……/æä¾›çš„èµ„æ–™æ¸…å•

| åºå· | èµ„æ–™é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|------|--------|------|------|
| 1 | MAX30102 ç¡¬ä»¶æ¥çº¿å›¾ | â¬œ å¾…æä¾› | å¦‚æœ‰å®ç‰©ï¼Œæ‹ç…§æˆ–ç”»å›¾ |
| 2 | æ•°æ®æ¸…æ´—æ•ˆæœå¯¹æ¯”å›¾ | â¬œ å¾…æä¾› | åŸå§‹æ•°æ® vs æ¸…æ´—åæ•°æ®æ³¢å½¢ |
| 3 | ç¤¾åŒºå¤§å±æˆªå›¾ | â¬œ å¾…æä¾› | è¿è¡Œå‰ç«¯åæˆªå›¾ |
| 4 | å‘Šè­¦ç®¡ç†é¡µé¢æˆªå›¾ | â¬œ å¾…æä¾› | è¿è¡Œå‰ç«¯åæˆªå›¾ |
| 5 | AIåŠ©æ‰‹å¯¹è¯æˆªå›¾ | â¬œ å¾…æä¾› | å±•ç¤º RAG æ•ˆæœçš„å¯¹è¯ |
| 6 | è¯­éŸ³äº¤äº’ç•Œé¢æˆªå›¾ | â¬œ å¾…æä¾› | æ‚¬æµ® AI åŠ©æ‰‹ç•Œé¢ |

---

## âœ… ä»£ç æˆªå›¾å»ºè®®

ä»¥ä¸‹æ–‡ä»¶å»ºè®®åœ¨ VS Code ä¸­æ‰“å¼€å¹¶æˆªå›¾ï¼š

### æ•°æ®å¤„ç†æ¨¡å—
1. **æ•°æ®æ¸…æ´— IQR/Z-score**ï¼š`frontend/health_assessment_system/core/data_pipeline.py` (ç¬¬ 627-640 è¡Œ)

### å¤š Agent æ¨¡å— â­é‡ç‚¹
2. **æ™ºèƒ½ä½“åè°ƒå™¨**ï¼š`frontend/health_assessment_system/agents/agent_coordinator.py` (ç¬¬ 57-92 è¡Œ route_message)
3. **å¤šAgentåä½œå¤„ç†**ï¼š`frontend/health_assessment_system/agents/agent_coordinator.py` (ç¬¬ 147-189 è¡Œ)
4. **æ…¢ç—…ä¸“å®¶åŒ»å­¦æ ‡å‡†**ï¼š`frontend/health_assessment_system/agents/chronic_disease_expert.py` (ç¬¬ 46-60 è¡Œ)
5. **å“åº”æ•´åˆç­–ç•¥**ï¼š`frontend/health_assessment_system/agents/agent_coordinator.py` (ç¬¬ 191-229 è¡Œ)

### RAG çŸ¥è¯†åº“
6. **FAISS æ£€ç´¢**ï¼š`backend/services/knowledge_base.py` (ç¬¬ 257-303 è¡Œ)

### è¯­éŸ³äº¤äº’
7. **Edge-TTS é…ç½®**ï¼š`backend/services/voice_service.py` (ç¬¬ 66-108 è¡Œ)
8. **FunASR é…ç½®**ï¼š`backend/services/voice_service.py` (ç¬¬ 130-165 è¡Œ)

### å‰ç«¯å¯è§†åŒ–
9. **Recharts å›¾è¡¨**ï¼š`frontend/src/components/dashboard/HealthCharts.tsx` (ç¬¬ 1-50 è¡Œ)

---

## ğŸ¯ æŠ€æœ¯äº®ç‚¹æ€»ç»“ï¼ˆPPT é‡ç‚¹å¼ºè°ƒï¼‰

| æ¨¡å— | æŠ€æœ¯äº®ç‚¹ | ç«äº‰åŠ› | é›†æˆçŠ¶æ€ |
|------|---------|--------|----------|
| **å¤š Agent åä½œ** | 4 ä¸“ä¸šæ™ºèƒ½ä½“ + åè°ƒå™¨ + ç½®ä¿¡åº¦è·¯ç”± | â­â­â­ é«˜ | âœ… å·²é›†æˆåˆ°ä¸»åç«¯ |
| **RAG çŸ¥è¯†å¢å¼º** | m3e-base + FAISS + åŒ»å­¦æ–‡æ¡£ | â­â­ ä¸­ | âœ… å·²é›†æˆ |
| **æ•°æ®æ¸…æ´—** | IQR + Z-score + ä¸šåŠ¡è§„åˆ™ä¸‰é‡è¿‡æ»¤ | â­â­ ä¸­ | âœ… å·²é›†æˆ |
| **è¯­éŸ³äº¤äº’** | FunASR + Edge-TTS + é€‚è€åŒ– | â­â­ ä¸­ | âœ… å·²é›†æˆ |

---

## âœ… å¤š Agent ç³»ç»Ÿé›†æˆè¯´æ˜

**å·²å®Œæˆé›†æˆ**ï¼šå¤šæ™ºèƒ½ä½“ç³»ç»Ÿå·²é›†æˆåˆ°ä¸»åç«¯ `backend/services/ai_service.py`

### è°ƒç”¨é“¾è·¯
```
ç”¨æˆ·è¯·æ±‚ â†’ /api/ai/consult â†’ ai_service.consult()
                                    â”‚
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ (ç½®ä¿¡åº¦ â‰¥ 0.7)   â”‚
                    â”‚  - å¥åº·ç®¡å®¶ã€æ…¢ç—…ä¸“å®¶          â”‚
                    â”‚  - ç”Ÿæ´»æ•™ç»ƒã€å¿ƒç†å…³æ€€å¸ˆ        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    ç½®ä¿¡åº¦é«˜ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€ ç½®ä¿¡åº¦ä½
                        â”‚                      â”‚
                        â–¼                      â–¼
                   ç›´æ¥è¿”å›              è°ƒç”¨ DeepSeek API
                   ä¸“å®¶å›å¤              å¢å¼ºå›å¤
```

### æ–°å¢ API æ¥å£
- `GET /api/ai/agents` - è·å–æ‰€æœ‰æ™ºèƒ½ä½“ä¿¡æ¯

### ä»£ç ä½ç½®
- æ™ºèƒ½ä½“æ¨¡å—ï¼š`backend/services/agents/`
- AIæœåŠ¡é›†æˆï¼š`backend/services/ai_service.py` (ç¬¬ 118-151 è¡Œ)
